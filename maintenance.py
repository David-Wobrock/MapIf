#!/usr/bin/env python3
# -!- encoding:utf8 -!-
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#    file: maintenance.py
#    date: 2017-09-19
#  author: paul.dautry
# purpose:
#       Perform maintenance actions on DB
#~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#===============================================================================
# IMPORTS 
#===============================================================================
from src.utils import db
from src.utils import ini
#===============================================================================
# FUNCTIONS 
#===============================================================================
#-------------------------------------------------------------------------------
# fix_issue_14
#       fix issue #14: safe password storage with salt and blowfish encryption
#       PATCH DB V1.3.0
#-------------------------------------------------------------------------------
#def fix_issue_14():
#    for u in db.get_all_users():
#        print("Updating: ", u, "...", end='')
#        db.update_user_password(u.id)
#        print("done!")
#-------------------------------------------------------------------------------
# confirm
#       ask for confirmation before running script
#-------------------------------------------------------------------------------
def confirm():
    print("Do you really want to run this script ? [yes/n]: ", end='')
    resp=input("");
    if resp != 'yes':
        exit(1)
#-------------------------------------------------------------------------------
# configure
#-------------------------------------------------------------------------------
def configure():
    # load ini file
    if not ini.init_config('mapif.ini'):
        logger.mprint("Configuration file is missing. Server can't be started !")
        exit(1)    
    # initialize database
    db.init_db()
#-------------------------------------------------------------------------------
# 
#-------------------------------------------------------------------------------
def main():
    confirm()
    configure()
    #fix_issue_14()
    exit(0)
#===============================================================================
# SCRIPT
#===============================================================================
if __name__ == '__main__':
    main()
